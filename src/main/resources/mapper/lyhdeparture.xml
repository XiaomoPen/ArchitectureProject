<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.seven.springboot.mapper.lyh.LyhDepartureDao">
    <resultMap id="findAll" type="com.seven.springboot.pojo.TPmDeparture">
        <id column="departure_erial" property="departureErial"></id>
        <result column="user_number" property="userNumber"></result>
        <result column="departure_time" property="departureTime"></result>
        <result column="departure_lztime" property="departureLztime"></result>
        <result column="departure_leix" property="departureLeix"></result>
        <result column="departure_reason" property="departureReason"></result>
        <result column="departure_note" property="departureNote"></result>
        <result column="departure_state" property="departureState"></result>

<association property="tPmUser" javaType="com.seven.springboot.pojo.TPmUser">
    <id column="user_number" property="userNumber"></id>
    <result column="user_Jobnumber" property="userJobNumber"></result>
    <result column="user_name" property="userName"></result>
    <result column="user_sex" property="userSex"></result>
    <result column="user_birthday" property="userBirthday"></result>
    <result column="user_intime" property="userIntime"></result>
    <result column="user_positive" property="userPositive"></result>
    <result column="user_departure" property="userDeparture"></result>
    <result column="position_number" property="positionNumber"></result>
    <result column="department_number" property="departmentNumber"></result>
    <result column="user_state" property="userState"></result>

    <association property="department" javaType="com.seven.springboot.pojo.TPmDepartment">
        <id column="department_number" property="departmentNumber"></id>
        <result column="department_name" property="departmentName"></result>
        <result column="department_time" property="departmentTime"></result>
        <result column="user_number" property="userNumber"></result>
    </association>

    <association property="tPmPosition" javaType="com.seven.springboot.pojo.TPmPosition">
        <id column="position_number" property="positionNumber"></id>
        <result column="position_name" property="positionName"></result>
        <result column="position_time" property="positionTime"></result>
        <result column="user_number" property="userNumber"></result>
    </association>
</association>
    </resultMap>

    <select id="findAll" resultMap="findAll">
        select * from t_pm_departure a
        left join t_pm_user b on a.user_number = b.user_number
        left join t_pm_department c on b.department_number =b.department_number
        left join t_pm_position d on b.position_number=d.position_number

    </select>



    <insert id="addDeparture">
        insert into t_pm_departure(departure_erial,user_number,
        departure_time,departure_lztime,departure_leix,
        departure_reason,departure_note,departure_state) values(#{departureErial},
        #{userNumber},#{departureTime},#{departureLztime},
        #{departureLeix},#{departureReason},#{departureNote},#{departureState})
    </insert>


    <select id="findAll2" resultMap="findAll">
        select * from t_pm_departure a
                          left join t_pm_user b on a.user_number = b.user_number
                          left join t_pm_department c on b.department_number =b.department_number
                          left join t_pm_position d on b.position_number=d.position_number
        <where>
            <if test="tPmUser.userName != null and tPmUser.userName !=''">
                and b.user_name like '%${tPmUser.userName}%'
            </if>
        <if test="tPmUser.department.departmentName !=null and tPmUser.department.departmentName !=''">
            and c.department_name like '%${tPmUser.department.departmentName}%'
        </if>
        </where>
    </select>

    <select id="findById" resultMap="findAll">
        select * from t_pm_departure a
                          left join t_pm_user b on a.user_number = b.user_number
                          left join t_pm_department c on b.department_number =b.department_number
                          left join t_pm_position d on b.position_number=d.position_number
        where a.departure_erial =#{departureErial}
    </select>

    <insert id="addmyapply">
        Insert into t_ps_myapply(myapply_num,myapply_number,
        myapply_name,myapply_state,myapply_type,user_number)
        values(?, #{departureErial},’离职’,0,’离职申请’,#{userNumber})

    </insert>
    <delete id="deldeparture">
        Delete from t_pm_departure where departure_erial =#{departureErial}
    </delete>
</mapper>