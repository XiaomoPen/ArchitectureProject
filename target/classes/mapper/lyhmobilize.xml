<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.seven.springboot.mapper.lyh.LyhMobilizeDao">
    <resultMap id="findAll" type="com.seven.springboot.pojo.TPmMobilize">
        <id column="mobilize_serial" property="mobilizeSerial"></id>
        <result column="user_number" property="userNumber"></result>
        <result column="user_name2" property="userName2"></result>
        <result column="mobilize_leix" property="mobilizeLeix"></result>
        <result column="mobilize_dept" property="mobilizeDept"></result>
        <result column="mobilize_gw" property="mobilizeGw"></result>
        <result column="department_number" property="departmentNumber"></result>
        <result column="position_number" property="positionNumber"></result>
        <result column="mobilize_note" property="mobilizeNote"></result>
        <result column="mobilize_time" property="mobilizeTime"></result>
        <result column="mobilize_state" property="mobilizeState"></result>


        <association property="tPmUser" javaType="com.seven.springboot.pojo.TPmUser">
        <id column="user_number" property="userNumber"></id>
        <result column="user_Jobnumber" property="userJobNumber"></result>
        <result column="user_name" property="userName"></result>
        <result column="user_sex" property="userSex"></result>
        <result column="user_birthday" property="userBirthday"></result>
        <result column="user_intime" property="userIntime"></result>
        <result column="user_positive" property="userPositive"></result>
        <result column="user_departure" property="userDeparture"></result>
        <result column="position_number" property="positionNumber"></result>
        <result column="department_number" property="departmentNumber"></result>
        <result column="user_state" property="userState"></result>


        <association property="department" javaType="com.seven.springboot.pojo.TPmDepartment">
            <id column="department_number" property="departmentNumber"></id>
            <result column="department_name" property="departmentName"></result>
            <result column="department_time" property="departmentTime"></result>
            <result column="user_number" property="userNumber"></result>
        </association>

        <association property="tPmPosition" javaType="com.seven.springboot.pojo.TPmPosition">
            <id column="position_number" property="positionNumber"></id>
            <result column="position_name" property="positionName"></result>
            <result column="position_time" property="positionTime"></result>
            <result column="user_number" property="userNumber"></result>
        </association>
        </association>
    </resultMap>




    <select id="findAll" resultMap="findAll">
        select * from t_pm_mobilize a
        left join t_pm_user b on a.user_number=b.user_number
        left join t_pm_department c on b.department_number=c.department_number
        left join t_pm_position d on b.position_number = d.position_number
    </select>

    <select id="findByName" resultMap="findAll">
        select * from t_pm_mobilize a
                          left join t_pm_user b on a.user_number=b.user_number
                          left join t_pm_department c on b.department_number=c.department_number
                          left join t_pm_position d on a.position_number = d.position_number
                where b.userName=#{userName}
    </select>



    <select id="findAll2" resultMap="findAll">

        select * from t_pm_mobilize a
                          left join t_pm_user b on a.user_number=b.user_number
                          left join t_pm_department c on b.department_number=c.department_number
                          left join t_pm_position d on b.position_number = d.position_number
<where>
    <if test="tPmUser.userName !=null and tPmUser.userName !=''">
        and b.user_name like '%${tPmUser.userName}%'
    </if>
    <if test="mobilizeState !=null and mobilizeState !=''">
        and a.mobilize_state like '%${mobilizeState}%'
    </if>
</where>
    </select>

    <insert id="addMobilize">
        insert into t_pm_mobilize(mobilize_serial,user_number,
        mobilize_leix,mobilize_dept,mobilize_gw,department_number,
        position_number,mobilize_note,mobilize_time,mobilize_state) values(
        #{mobilizeSerial},#{userNumber},#{mobilizeLeix},#{mobilize_dept},#{mobilize_gw},
        #{departmentNumber},#{positionNumber},#{mobilizeNote},#{mobilizeTime},#{mobilizeState})
    </insert>
    <insert id="addMyapply">
        Insert into t_ps_myapply(myapply_num,myapply_number,
                                 myapply_name,myapply_state,myapply_type,user_number)
        values (#{mobilizeNumber},"人事调动",0,"人事调动",#{userName})

    </insert>
</mapper>